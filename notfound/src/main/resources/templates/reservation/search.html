<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>예약</title>
    <link rel="stylesheet" href="/css/payment/payment-select-one.css">
    <script src="/js/reservation/reservation-select-one.js" defer></script>

<body>

<h2>예약 내역 검색</h2>

<!-- 🔥 검색 유형 선택 드롭다운 -->
<div class="search-container">
    <select id="searchType" onchange="toggleSearchFields()">
        <option value="reservationCode">예약번호로 검색</option>
        <option value="reservationDate">예약일자로 검색</option>
        <option value="reservationPeriod">기간으로 검색</option>
    </select>

    <form action="/reservation/search" method="get" onsubmit="return validateForm()">
        <!-- 🔥 결제번호 검색 -->
        <div id="reservationCodeSearch">
            <input type="text" name="reservationCode" placeholder="예약번호를 입력하세요">
            <button type="submit" class="search-button">검색</button>
        </div>

        <!-- 🔥 결제일자 검색 -->
        <div id="reservationDateSearch" style="display: none;">
            <input type="date" name="reservationDate">
            <button type="submit" class="search-button">검색</button>
        </div>

        <!-- 🔥 결제기간 검색 -->
        <div id="reservationPeriodSearch" style="display: none;">
            <input type="date" name="startDatetime" id="startDateInput" onchange="validateDates()">
            <span>~</span>
            <input type="date" name="endDate" id="endDatetimeInput" onchange="validateDates()">
            <button type="submit" class="search-button">검색</button>
        </div>
    </form>


<form action = "/reservation/search/all" method = "get">
    <button type="submit" class="search-button">전체 조회</button>
</form>
</div>
    <!-- 🔥 검색 결과 없음 메시지 -->
    <p th:if="${searchExecuted and
((searchReservation == null or #lists.isEmpty(searchReservation)) and (reservationList == null or #lists.isEmpty(reservationList)))}" id="noResultsMessage">
        검색 결과가 없습니다.
    </p>

<table th:if="${searchExecuted != null and not #lists.isEmpty(reservationList)}">
        <thead>
        <tr>
            <th>예약번호</th>
            <th>회원 ID</th>
            <th>사무실</th>
            <th>예약날짜</th>
            <th>이용시작시간</th>
            <th>이용마감시간</th>
            <th>가격</th>
            <th>예약완료날짜</th>
        </tr>
        <tr th:each="reservation : ${reservationList}">
            <td th:text="${reservation.reservationCode != null ? reservation.reservationCode : 'N/A'}"></td>
            <td th:text="${reservation.memberCode != null ? reservation.memberCode : 'N/A'}"></td>
            <td th:text="${reservation.storeName}"></td>
            <td th:text="${reservation.startDatetime != null ? #temporals.format(reservation.startDatetime, 'yyyy-MM-dd') : '날짜 없음'}"></td>
            <td th:text="${reservation.startDatetime != null ? #temporals.format(reservation.startDatetime, 'HH:mm') : '시간 없음'}"></td>
            <td th:text="${reservation.endDatetime != null ? #temporals.format(reservation.endDatetime, 'HH:mm') : '시간 없음'}"></td>
            <td th:text="${reservation.totalPrice != null ? #numbers.formatInteger(reservation.totalPrice, 3, 'COMMA') + '원' : '가격 없음'}"></td>
            <td th:text="${reservation.reservationDate != null ? #temporals.format(reservation.reservationDate, 'yyyy-MM-dd') : '날짜 없음'}"></td>

        </tr>

    </table>
    <table th:if="${searchExecuted and not #lists.isEmpty(searchReservation)}">
        <tr>
            <th>예약번호</th>
            <th>회원 ID</th>
            <th>사무실</th>
            <th>예약날짜</th>
            <th>이용시작시간</th>
            <th>이용마감시간</th>
            <th>가격</th>
            <th>예약완료날짜</th>
        </tr>
        <tr th:each="reservation : ${searchReservation}">
            <td th:text="${reservation.reservationCode != null ? reservation.reservationCode : 'N/A'}"></td>
            <td th:text="${reservation.memberCode != null ? reservation.memberCode : 'N/A'}"></td>
            <td th:text="${reservation.storeName}"></td>
            <td th:text="${reservation.startDatetime != null ? #temporals.format(reservation.startDatetime, 'yyyy-MM-dd') : '날짜 없음'}"></td>
            <td th:text="${reservation.startDatetime != null ? #temporals.format(reservation.startDatetime, 'HH:mm') : '시간 없음'}"></td>
            <td th:text="${reservation.endDatetime != null ? #temporals.format(reservation.endDatetime, 'HH:mm') : '시간 없음'}"></td>
            <td th:text="${reservation.totalPrice != null ? #numbers.formatInteger(reservation.totalPrice, 3, 'COMMA') + '원' : '가격 없음'}"></td>
            <td th:text="${reservation.reservationDate != null ? #temporals.format(reservation.reservationDate, 'yyyy-MM-dd') : '날짜 없음'}"></td>
        </tr>
    </table>
</body>
</html>