<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="/css/header.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        main {
            margin-top: 280px; /* 헤더 높이만큼 여백 추가 */
            padding: 20px; /* 내부 여백 */
        }
        .store-thumbnail{
            width: 500px;
            height: 500px;
        }
        .pic{
            display: flex;
            justify-content: center;  /* 가로 중앙 정렬 */
            align-items: center;      /* 세로 중앙 정렬 */
        }
        .lounge1{
            width: 400px;
            height: 300px;
        }
        .lounge2{
            width: 400px;
            height: 300px;
        }
        .lounge3{
            width: 400px;
            height: 300px;
        }
        .offices {
            display: flex;
            flex-wrap: wrap; /* 줄바꿈 허용 */
            gap: 20px; /* 카드 간의 간격 */
            justify-content: center; /* 가운데 정렬 */
            margin-top: 20px;
        }

        .office-card {
            max-width: 300px; /* 카드 최대 너비 */
            aspect-ratio: 4 / 3; /* 직사각형 비율 유지 */
            background-color: #ffffff; /* 배경 색상 */
            border: 1px solid #56AEA8; /* 테두리 추가 */
            border-radius: 10px; /* 모서리 완만하게 */
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* 약간의 그림자 */
            text-align: right; /* 텍스트 가운데 정렬 */
            display: flex;
            flex-direction: column; /* 수직 정렬 */
            align-items: center; /* 가운데 정렬 */
            justify-content: space-between; /* 여유 공간 배분 */
        }
        .office-card img {
            width: 90%; /* 카드의 이미지 너비 */
            height: 70%; /* 높이를 비율에 따라 조정 */
            object-fit: cover; /* 이미지 왜곡 방지 */
            border-radius: 5px; /* 이미지를 둥글게 */
        }
        .review {
            margin-top: 40px;
            padding: 20px;
            background-color: #f9f9f9; /* 부드러운 배경색 */
            border-radius: 10px; /* 모서리 둥글게 처리 */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* 약간의 그림자 추가 */
            display: flex;
            flex-direction: column; /* 리뷰 섹션을 수직 레이아웃으로 정렬 */
            gap: 20px; /* 리뷰 간 간격 */
        }
        .card-text {
            margin: 0;
        }
        .text-body-secondary {
            margin-left: 120px;
        }
        .card-body h5 {
            margin-top: 10px;
            margin-bottom: 10px;
        }

    </style>
    <title>선택지점상세페이지</title>
</head>
<body>
<div th:replace="~{fragments/header :: header}"></div>
<main>
    <section class="store">
        <article class="info">
            <table>
                <tr>
                    <td>
                        <img th:src="${store.storeThumbnailUrl}" th:alt="${store.storeName}" class="store-thumbnail">
                    </td>
                    <td>
                        <h1 class="store-name"><strong th:text="${store.storeName}"></strong></h1>
                        <p th:text="${store.storeAddress}">상세주소</p>
                        <p th:text="${store.description}">지점 설명</p>
                    </td>
                </tr>
            </table>
        </article>
        <article class="share">
            <div class="pic">
                <img th:src="${store.storeImg1Url}" th:alt="|${store.storeName}의 공용공간 입니다.|" class="lounge1">
                <img th:src="${store.storeImg2Url}" th:alt="|${store.storeName}의 공용공간 입니다.|" class="lounge2">
                <img th:src="${store.storeImg3Url}" th:alt="|${store.storeName}의 공용공간 입니다.|" class="lounge3">
            </div>
        </article>
    </section>

    <hr class="separator">

    <section class="map-area">
        <div id="storeMap">
            <div id="map" style="width:1300px; height:500px; display: flex; margin: 0 auto; "></div>

            <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=65a5c45f0f71eab8b6e0448937121045"></script>
            <script th:inline="javascript">
                var latitude = [[${store.latitude}]];
                var longitude = [[${store.longitude}]];
                var storeName = [[${store.storeName}]];

                var mapContainer = document.getElementById('map'), // 지도를 표시할 div
                    mapOption = {
                        center: new kakao.maps.LatLng(latitude, longitude), // 지도의 중심좌표
                        level: 3 // 지도의 확대 레벨
                    };

                // 지도를 표시할 div와  지도 옵션으로  지도를 생성합니다
                var map = new kakao.maps.Map(mapContainer, mapOption);

                // 마커가 표시될 위치입니다
                var markerPosition  = new kakao.maps.LatLng(latitude, longitude);

                // 마커를 생성합니다
                var marker = new kakao.maps.Marker({
                    position: markerPosition
                });

                // 마커가 지도 위에 표시되도록 설정합니다
                marker.setMap(map);

                // 아래 코드는 지도 위의 마커를 제거하는 코드입니다
                // marker.setMap(null);

                // 인포윈도우 표시
                var infowindow = new kakao.maps.InfoWindow({
                    content: '<div style="padding:5px;font-size:12px;">' + storeName + '</div>' // html 형태로 메시지 표시
                });
                infowindow.open(map, marker);
            </script>
        </div>
        <script>
            function myFunction() {
                var x = document.getElementById("storeMap");
                if (x.style.display === "none") {
                    x.style.display = "block";
                } else {
                    x.style.display = "none";
                }
            }
        </script>
    </section>

    <hr class="separator">

    <section class="offices">

        <div th:each="office : ${officeList}" class="office-card">
            <img th:src="${office.officeThumbnailUrl}" th:alt="|${store.storeName}의 ${office.officeNum}호실 이미지|" />
            <div class="details">
                <h3 th:text="|${office.officeNum}호실|"></h3>
                <p th:text="|타입: ${office.officeType}|"></p>
                <p th:text="|2시간당: ${office.officePrice}원|"></p>
            </div>


            <button class="reserve-btn"
                    th:data-officeCode="${office.officeCode}"
                    onclick="goToReservation(this)">
                예약하러 가기
            </button>
        </div>
    </section>

    <hr class="separator">

    <section class="review">
        <div th:if="${not #lists.isEmpty(FindOfficeReview)}">

            <!--<th>이미지 파일 경로</th>-->
            <div class="card mb-3" th:each="officeReview : ${FindOfficeReview}">
                <div class="row g-0">
                    <div class="col-md-4">
                        <img th:src="${officeReview.reviewImage}" class="img-fluid rounded-start" th:alt="|${officeReview.officeNum}호의 리뷰 이미지|">
                    </div>
                    <div class="col-md-8">
                        <div class="card-body">
                            <p class="card-text">아이디</p>
                            <small class="text-body-secondary" th:text="${officeReview.memberId}"></small>
                            <p class="card-text">등록일자</p>
                            <small class="text-body-secondary" th:text="${officeReview.reviewDate}"></small>
                            <p class="card-text">사무실 유형</p>
                            <small class="text-body-secondary" th:text="${officeReview.officeType}"></small>
                            <p class="card-text">사무실 호실</p>
                            <small class="text-body-secondary" th:text="${officeReview.officeNum}"></small>
                            <p class="card-text">평점</p>
                            <small class="text-body-secondary" th:text="|${officeReview.reviewRating}점|"></small>
                            <h5 class="card-title">제목</h5>
                            <p class="card-text" th:text="${officeReview.reviewTitle}">제목에 들어갈거</p>
                            <h5 class="card-title">내용</h5>
                            <p class="card-text" th:text="${officeReview.reviewContent}">내용에 들어갈거</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div th:if="${#lists.isEmpty(FindOfficeReview)}">
            <p> 등록된 리뷰가 없습니다. </p>
        </div>
    </section>

    <hr class="separator">
</main>
<aside class="left-aside">

</aside>
<aside class="right-aside">

</aside>
<div th:replace="~{fragments/footer :: footer}"></div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous">

    function goToReservation(button) {
        const officeCode = button.getAttribute("data-officeCode");

        if (!officeCode || officeCode === "undefined" || officeCode === "null") {
            alert("예약할 수 없는 사무실입니다.");
            return;
        }

        location.href = `/reservation/register/${officeCode}`;
    }
    document.addEventListener("DOMContentLoaded", function() {
        function goToReservation(button) {
            const officeCode = button.getAttribute("data-officeCode");

            if (!officeCode || officeCode === "undefined" || officeCode === "null") {
                alert("예약할 수 없는 사무실입니다.");
                return;
            }

            location.href = `/reservation/register/${officeCode}`;
        }

        // 전역 범위에서 함수를 사용할 수 있도록 설정
        window.goToReservation = goToReservation;
    });

</script>

</body>
</html>